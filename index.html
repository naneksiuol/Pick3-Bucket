<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Pick 3 Strategy Dashboard</title>
   <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
   <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
   <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Bebas+Neue&display=swap');

       :root {
           --bg: #06080f;
           --panel: #0b1120;
           --panel2: #0e1628;
           --border: #1a2f4a;
           --gold: #f5c842;
           --gold2: #c8a020;
           --cyan: #00d4ff;
           --red: #ff4455;
           --green: #00e87a;
           --purple: #b06cff;
           --orange: #ff8c42;
           --dim: #3a5a7a;
           --text: #b8d0e8;
           --text2: #6a8aa8;
       }

       * { box-sizing: border-box; margin: 0; padding: 0; }
       body, #root { background: var(--bg); color: var(--text); font-family: 'Share Tech Mono', monospace; min-height: 100vh; }

       .app { max-width: 1040px; margin: 0 auto; padding: 24px 16px 48px; }

       /* HEADER */
       .header { text-align: center; margin-bottom: 28px; }
       .header h1 { font-family: 'Bebas Neue', sans-serif; font-size: 2.9rem; letter-spacing: 8px;
           background: linear-gradient(135deg, var(--gold) 0%, #ff8c42 50%, var(--cyan) 100%);
           -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1; }
       .header sub { font-size: 0.65rem; letter-spacing: 4px; color: var(--dim); display: block; margin-top: 6px; }

       /* TABS */
       .tabs { display: flex; gap: 4px; margin-bottom: 20px; background: var(--panel); border: 1px solid var(--border); border-radius: 10px; padding: 5px; }
       .tab { flex: 1; padding: 10px; text-align: center; font-size: 0.65rem; letter-spacing: 3px; border-radius: 7px;
           cursor: pointer; border: none; background: transparent; color: var(--dim); font-family: 'Share Tech Mono', monospace; transition: all 0.2s; }
       .tab.active { background: linear-gradient(135deg, #1a2f4a, #0e1e32); color: var(--gold); border: 1px solid var(--border); }

       /* PANELS */
       .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 22px; margin-bottom: 16px; position: relative; overflow: hidden; }
       .panel::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; }
       .panel.gold::before { background: linear-gradient(90deg, transparent, var(--gold), transparent); }
       .panel.cyan::before { background: linear-gradient(90deg, transparent, var(--cyan), transparent); }
       .panel.purple::before { background: linear-gradient(90deg, transparent, var(--purple), transparent); }
       .panel.orange::before { background: linear-gradient(90deg, transparent, var(--orange), transparent); }
       .panel.green::before { background: linear-gradient(90deg, transparent, var(--green), transparent); }

       .panel-label { font-size: 0.6rem; letter-spacing: 4px; color: var(--gold); margin-bottom: 16px; text-transform: uppercase; }
       .panel-label.cyan { color: var(--cyan); }
       .panel-label.purple { color: var(--purple); }
       .panel-label.green { color: var(--green); }
       .panel-label.orange { color: var(--orange); }

       /* DRAW INPUT */
       .draw-row { display: flex; gap: 14px; align-items: center; flex-wrap: wrap; }
       .big-input { background: #000; border: 2px solid var(--border); border-radius: 8px; color: var(--gold);
           font-family: 'Bebas Neue', sans-serif; font-size: 2.8rem; letter-spacing: 14px;
           padding: 10px 20px; width: 190px; text-align: center; outline: none; transition: border-color 0.2s; }
       .big-input:focus { border-color: var(--gold); }
       .big-input::placeholder { color: #1a2a3a; }

       .key-chips { display: flex; gap: 10px; align-items: flex-end; }
       .key-chip-wrap { display: flex; flex-direction: column; align-items: center; gap: 3px; }
       .key-chip { width: 54px; height: 54px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
           font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; border: 2px solid; transition: all 0.3s; }
       .kc-0 { border-color: var(--gold); color: var(--gold); background: rgba(245,200,66,.08); }
       .kc-1 { border-color: var(--cyan); color: var(--cyan); background: rgba(0,212,255,.08); }
       .kc-2 { border-color: var(--orange); color: var(--orange); background: rgba(255,140,66,.08); }
       .kc-label { font-size: 0.55rem; color: var(--dim); letter-spacing: 2px; }

       /* FILTERS */
       .filter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 10px; margin-top: 12px; }
       .fcard { background: #000; border: 1px solid var(--border); border-radius: 8px; padding: 12px; cursor: pointer;
           transition: all 0.2s; user-select: none; }
       .fcard:hover { border-color: var(--dim); }
       .fcard.on { border-color: var(--gold); background: rgba(245,200,66,.04); }
       .fcard-top { display: flex; justify-content: space-between; align-items: center; }
       .fcard-name { font-size: 0.72rem; color: var(--text); }
       .toggle { width: 34px; height: 17px; border-radius: 9px; background: var(--dim); position: relative; transition: background 0.2s; flex-shrink: 0; }
       .toggle.on { background: var(--gold); }
       .toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 13px; height: 13px; border-radius: 50%; background: #fff; transition: transform 0.2s; }
       .toggle.on::after { transform: translateX(17px); }
       .fcard-desc { font-size: 0.62rem; color: var(--dim); margin-top: 5px; line-height: 1.4; }
       .fcard-impact { font-size: 0.6rem; color: var(--green); margin-top: 3px; }
       .sub-controls { margin-top: 8px; display: flex; gap: 8px; align-items: center; }
       .mini-input { background: #000; border: 1px solid var(--border); border-radius: 4px; color: var(--cyan);
           font-family: 'Share Tech Mono', monospace; font-size: 0.85rem; padding: 4px 8px; width: 58px; text-align: center; outline: none; }
       .mini-input:focus { border-color: var(--cyan); }
       .mini-label { font-size: 0.6rem; color: var(--dim); }
       .pos-btn { background: transparent; border: 1px solid var(--border); border-radius: 4px; color: var(--dim);
           font-family: 'Share Tech Mono', monospace; font-size: 0.7rem; padding: 4px 10px; cursor: pointer; transition: all 0.2s; }
       .pos-btn.sel { background: var(--gold); color: #000; border-color: var(--gold); }

       /* STATS ROW */
       .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 16px; }
       .scard { background: var(--panel); border: 1px solid var(--border); border-radius: 10px; padding: 14px; text-align: center; position: relative; overflow: hidden; }
       .scard::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; }
       .scard.g::after { background: var(--gold); }
       .scard.c::after { background: var(--cyan); }
       .scard.gr::after { background: var(--green); }
       .scard.r::after { background: var(--red); }
       .scard.p::after { background: var(--purple); }
       .snum { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; line-height: 1; }
       .scard.g .snum { color: var(--gold); }
       .scard.c .snum { color: var(--cyan); }
       .scard.gr .snum { color: var(--green); }
       .scard.r .snum { color: var(--red); }
       .scard.p .snum { color: var(--purple); }
       .slabel { font-size: 0.55rem; letter-spacing: 3px; color: var(--dim); text-transform: uppercase; margin-top: 3px; }
       .stag { font-size: 0.58rem; margin-top: 4px; }

       /* TIER CARDS */
       .tier-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 14px; }

       .tier-card {
           border-radius: 14px;
           overflow: hidden;
           border: 1px solid;
           position: relative;
           background: var(--panel2);
       }

       .tier-card.t25 { border-color: rgba(176,108,255,0.35); }
       .tier-card.t50 { border-color: rgba(0,212,255,0.35); }
       .tier-card.t100 { border-color: rgba(245,200,66,0.5); }

       .tier-header {
           padding: 16px 20px 14px;
           position: relative;
           overflow: hidden;
       }

       .tier-card.t25 .tier-header { background: linear-gradient(135deg, rgba(176,108,255,0.15), rgba(176,108,255,0.05)); }
       .tier-card.t50 .tier-header { background: linear-gradient(135deg, rgba(0,212,255,0.15), rgba(0,212,255,0.05)); }
       .tier-card.t100 .tier-header { background: linear-gradient(135deg, rgba(245,200,66,0.2), rgba(245,200,66,0.05)); }

       .tier-price-row { display: flex; justify-content: space-between; align-items: flex-start; }
       .tier-price {
           font-family: 'Bebas Neue', sans-serif;
           font-size: 2.6rem;
           line-height: 1;
       }
       .tier-card.t25 .tier-price { color: var(--purple); }
       .tier-card.t50 .tier-price { color: var(--cyan); }
       .tier-card.t100 .tier-price { color: var(--gold); }

       .tier-win-badge {
           text-align: right;
       }
       .tier-win-label { font-size: 0.55rem; letter-spacing: 2px; color: var(--dim); }
       .tier-win-amount {
           font-family: 'Bebas Neue', sans-serif;
           font-size: 1.8rem;
           line-height: 1.1;
       }
       .tier-card.t25 .tier-win-amount { color: var(--purple); }
       .tier-card.t50 .tier-win-amount { color: var(--cyan); }
       .tier-card.t100 .tier-win-amount { color: var(--gold); }

       .tier-label { font-size: 0.6rem; letter-spacing: 3px; color: var(--dim); margin-top: 2px; }

       .tier-body { padding: 16px 20px 20px; }

       .tier-stat-row { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
       .tier-stat-key { font-size: 0.62rem; color: var(--dim); letter-spacing: 2px; }
       .tier-stat-val { font-size: 0.85rem; color: var(--text); }
       .tier-stat-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

       .budget-input-row { display: flex; align-items: center; gap: 8px; margin-top: 6px; }
       .budget-input {
           background: #000; border: 1px solid var(--border); border-radius: 6px;
           color: var(--text); font-family: 'Share Tech Mono', monospace; font-size: 0.9rem;
           padding: 7px 12px; width: 120px; outline: none; transition: border-color 0.2s;
       }
       .budget-input:focus { border-color: var(--gold); }
       .budget-label { font-size: 0.62rem; color: var(--dim); letter-spacing: 2px; }

       .tier-profit { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; }
       .profit-pos { color: var(--green); }
       .profit-neg { color: var(--red); }

       .progress-bar-wrap { margin-top: 12px; }
       .progress-bar-label { display: flex; justify-content: space-between; font-size: 0.58rem; color: var(--dim); margin-bottom: 4px; }
       .progress-bar-track { height: 6px; background: #000; border-radius: 3px; overflow: hidden; border: 1px solid var(--border); }
       .progress-bar-fill { height: 100%; border-radius: 3px; transition: width 0.4s ease; }
       .tier-card.t25 .progress-bar-fill { background: linear-gradient(90deg, var(--purple), rgba(176,108,255,0.5)); }
       .tier-card.t50 .progress-bar-fill { background: linear-gradient(90deg, var(--cyan), rgba(0,212,255,0.5)); }
       .tier-card.t100 .progress-bar-fill { background: linear-gradient(90deg, var(--gold), rgba(245,200,66,0.5)); }

       /* PLAY SELECTOR */
       .play-controls { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; align-items: center; }
       .select-btn { background: transparent; border: 1px solid var(--border); border-radius: 6px; color: var(--dim);
           font-family: 'Share Tech Mono', monospace; font-size: 0.65rem; letter-spacing: 2px; padding: 7px 14px;
           cursor: pointer; transition: all 0.2s; }
       .select-btn:hover { border-color: var(--text2); color: var(--text); }
       .select-btn.active { border-color: var(--gold); color: var(--gold); background: rgba(245,200,66,.06); }

       .tier-select-row { display: flex; gap: 8px; }
       .tier-sel-btn { flex: 1; background: transparent; border: 1px solid var(--border); border-radius: 6px;
           font-family: 'Share Tech Mono', monospace; font-size: 0.65rem; letter-spacing: 2px; padding: 7px;
           cursor: pointer; transition: all 0.2s; text-align: center; }
       .tier-sel-btn.t25 { color: var(--purple); }
       .tier-sel-btn.t50 { color: var(--cyan); }
       .tier-sel-btn.t100 { color: var(--gold); }
       .tier-sel-btn.t25.sel { background: rgba(176,108,255,0.1); border-color: var(--purple); }
       .tier-sel-btn.t50.sel { background: rgba(0,212,255,0.1); border-color: var(--cyan); }
       .tier-sel-btn.t100.sel { background: rgba(245,200,66,0.1); border-color: var(--gold); }

       .num-grid-wrap { max-height: 380px; overflow-y: auto; padding-right: 4px; }
       .num-grid-wrap::-webkit-scrollbar { width: 4px; }
       .num-grid-wrap::-webkit-scrollbar-track { background: #000; }
       .num-grid-wrap::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

       .num-grid { display: flex; flex-wrap: wrap; gap: 4px; }

       .npill {
           font-size: 0.72rem; padding: 4px 8px; border-radius: 5px; border: 1px solid;
           cursor: pointer; transition: all 0.12s; letter-spacing: 1px; user-select: none;
       }
       .npill.default { border-color: rgba(26,47,74,0.8); color: var(--text2); background: rgba(10,22,40,0.5); }
       .npill.default:hover { border-color: var(--dim); color: var(--text); }
       .npill.sel-t25 { border-color: var(--purple); color: var(--purple); background: rgba(176,108,255,0.1); }
       .npill.sel-t50 { border-color: var(--cyan); color: var(--cyan); background: rgba(0,212,255,0.1); }
       .npill.sel-t100 { border-color: var(--gold); color: var(--gold); background: rgba(245,200,66,0.12); }

       /* TICKET VIEW */
       .ticket { background: linear-gradient(135deg, #000 0%, #0a1020 100%); border: 2px dashed var(--border);
           border-radius: 12px; padding: 20px; margin-top: 16px; }
       .ticket-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px;
           padding-bottom: 12px; border-bottom: 1px dashed var(--border); }
       .ticket-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 4px; color: var(--gold); }
       .ticket-date { font-size: 0.6rem; color: var(--dim); }
       .ticket-tiers { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
       .ticket-tier { padding: 12px; border-radius: 8px; border: 1px solid; }
       .ticket-tier.t25 { border-color: rgba(176,108,255,0.3); }
       .ticket-tier.t50 { border-color: rgba(0,212,255,0.3); }
       .ticket-tier.t100 { border-color: rgba(245,200,66,0.3); }
       .ticket-tier-head { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.65rem; }
       .tt-price.t25 { color: var(--purple); }
       .tt-price.t50 { color: var(--cyan); }
       .tt-price.t100 { color: var(--gold); }
       .tt-nums { display: flex; flex-wrap: wrap; gap: 3px; }
       .tt-num { font-size: 0.68rem; padding: 2px 6px; border-radius: 3px; }
       .tt-num.t25 { color: var(--purple); background: rgba(176,108,255,0.1); }
       .tt-num.t50 { color: var(--cyan); background: rgba(0,212,255,0.1); }
       .tt-num.t100 { color: var(--gold); background: rgba(245,200,66,0.1); }
       .ticket-footer { margin-top: 14px; padding-top: 12px; border-top: 1px dashed var(--border);
           display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
       .tf-item { text-align: center; }
       .tf-val { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; }
       .tf-label { font-size: 0.55rem; color: var(--dim); letter-spacing: 2px; }

       .copy-ticket-btn { background: var(--gold); color: #000; border: none; border-radius: 6px;
           font-family: 'Share Tech Mono', monospace; font-size: 0.7rem; letter-spacing: 2px; padding: 9px 18px;
           cursor: pointer; transition: all 0.2s; font-weight: bold; }
       .copy-ticket-btn:hover { background: var(--gold2); }

       .no-data { text-align: center; padding: 50px; color: var(--dim); font-size: 0.72rem; letter-spacing: 3px; }

       @media (max-width: 600px) {
           .header h1 { font-size: 2rem; }
           .big-input { width: 150px; font-size: 2rem; }
           .tier-grid { grid-template-columns: 1fr; }
       }
   </style>
</head>
<body>
   <div id="root"></div>
   <script type="text/babel">
       const { useState, useMemo, useCallback } = React;

       const TIERS = [
           { id: "t25", price: 0.25, win: 225, label: "QUARTER PLAY", color: "var(--purple)" },
           { id: "t50", price: 0.50, win: 450, label: "HALF DOLLAR PLAY", color: "var(--cyan)" },
           { id: "t100", price: 1.00, win: 900, label: "DOLLAR PLAY", color: "var(--gold)" },
       ];

       function pick3HasDigit(num, digit) {
           const s = String(num).padStart(3, "0");
           return s[0] === String(digit) || s[1] === String(digit) || s[2] === String(digit);
       }
       function digitSum(num) {
           return String(num).padStart(3, "0").split("").reduce((a, c) => a + +c, 0);
       }
       function isTriple(num) {
           const s = String(num).padStart(3, "0");
           return s[0] === s[1] && s[1] === s[2];
       }
       function hasNonKeyDouble(num, keys) {
           const s = String(num).padStart(3, "0");
           const freq = {};
           s.split("").forEach(d => { freq[d] = (freq[d] || 0) + 1; });
           for (const [d, cnt] of Object.entries(freq)) {
               if (cnt >= 2 && !keys.includes(Number(d))) return true;
           }
           return false;
       }
       function isAllOdd(num) {
           return String(num).padStart(3, "0").split("").every(d => [1,3,5,7,9].includes(+d));
       }
       function isAllEven(num) {
           return String(num).padStart(3, "0").split("").every(d => [0,2,4,6,8].includes(+d));
       }
       function toBoxKey(num) {
           return String(num).padStart(3, "0").split("").sort().join("");
       }
       function fmt3(n) { return String(n).padStart(3, "0"); }
       function fmtMoney(n) { return "$" + n.toFixed(2); }

       function Pick3FullStrategy() {
           const [lastDraw, setLastDraw] = useState("");
           const [budget, setBudget] = useState(20);
           const [activeTab, setActiveTab] = useState("analyze");
           const [activeTier, setActiveTier] = useState("t25");
           const [selectedNums, setSelectedNums] = useState({});
           const [sumMin, setSumMin] = useState(3);
           const [sumMax, setSumMax] = useState(24);
           const [filters, setFilters] = useState({
               noTriples: true,
               noNonKeyDoubles: false,
               sumRange: true,
               noAllOdd: false,
               noAllEven: false,
               keyInPosition: false,
               keyPosition: 0,
           });

           const keyDigits = useMemo(() => {
               const raw = lastDraw.replace(/\D/g, "").slice(0, 3);
               if (raw.length !== 3) return [];
               return [...new Set(raw.split("").map(Number))];
           }, [lastDraw]);

           const filteredStraight = useMemo(() => {
               if (keyDigits.length === 0) return [];
               let pool = [];
               for (let i = 0; i < 1000; i++) {
                   if (keyDigits.some(k => pick3HasDigit(i, k))) pool.push(i);
               }
               if (filters.noTriples) pool = pool.filter(n => !isTriple(n));
               if (filters.noNonKeyDoubles) pool = pool.filter(n => !hasNonKeyDouble(n, keyDigits));
               if (filters.sumRange) pool = pool.filter(n => { const s = digitSum(n); return s >= sumMin && s <= sumMax; });
               if (filters.noAllOdd) pool = pool.filter(n => !isAllOdd(n));
               if (filters.noAllEven) pool = pool.filter(n => !isAllEven(n));
               if (filters.keyInPosition) {
                   pool = pool.filter(n => keyDigits.includes(Number(String(n).padStart(3,"0")[filters.keyPosition])));
               }
               return pool;
           }, [keyDigits, filters, sumMin, sumMax]);

           const filteredBox = useMemo(() => {
               const seen = new Set();
               const box = [];
               for (const n of filteredStraight) {
                   const key = toBoxKey(n);
                   if (!seen.has(key)) { seen.add(key); box.push(key); }
               }
               return box.sort();
           }, [filteredStraight]);

           const toggleFilter = (key) => setFilters(f => ({ ...f, [key]: !f[key] }));

           const getSelTier = useCallback((num) => selectedNums[fmt3(num)] || null, [selectedNums]);
           const toggleNum = useCallback((num) => {
               const key = fmt3(num);
               setSelectedNums(prev => {
                   const cur = prev[key];
                   if (cur === activeTier) {
                       const next = { ...prev };
                       delete next[key];
                       return next;
                   }
                   return { ...prev, [key]: activeTier };
               });
           }, [activeTier]);

           const selectByBudget = useCallback((tierId) => {
               const tier = TIERS.find(t => t.id === tierId);
               const maxNums = Math.floor(budget / tier.price);
               const toSelect = filteredStraight.slice(0, maxNums);
               const next = {};
               toSelect.forEach(n => { next[fmt3(n)] = tierId; });
               setSelectedNums(next);
               setActiveTier(tierId);
           }, [budget, filteredStraight]);

           const clearAll = () => setSelectedNums({});

           const selCounts = useMemo(() => {
               const counts = { t25: 0, t50: 0, t100: 0 };
               Object.values(selectedNums).forEach(t => { if (counts[t] !== undefined) counts[t]++; });
               return counts;
           }, [selectedNums]);

           const totalCost = useMemo(() => {
               return TIERS.reduce((sum, t) => sum + selCounts[t.id] * t.price, 0);
           }, [selCounts]);

           const potentialWin = useMemo(() => {
               return TIERS.reduce((sum, t) => sum + (selCounts[t.id] > 0 ? t.win : 0), 0);
           }, [selCounts]);

           const bestWin = useMemo(() => Math.max(...TIERS.map(t => selCounts[t.id] > 0 ? t.win : 0)), [selCounts]);
           const netProfit = bestWin > 0 ? bestWin - totalCost : 0;

           const reduction = filteredStraight.length > 0 ? Math.round((1 - filteredStraight.length / 1000) * 100) : 0;

           return (
               <div className="app">
                   <div className="header">
                       <h1>PICK 3 STRAIGHT STRATEGY</h1>
                       <sub>KEY DIGIT · SMART FILTER · MULTI-TIER BET PLANNER</sub>
                   </div>

                   <div className="tabs">
                       {[
                           { id: "analyze", label: "▶ ANALYZE" },
                           { id: "tiers", label: "◆ BET TIERS" },
                           { id: "builder", label: "✦ TICKET BUILDER" },
                       ].map(t => (
                           <button key={t.id} className={`tab ${activeTab === t.id ? "active" : ""}`} onClick={() => setActiveTab(t.id)}>
                               {t.label}
                           </button>
                       ))}
                   </div>

                   {/* ===== TAB 1: ANALYZE ===== */}
                   {activeTab === "analyze" && (
                       <>
                           <div className="panel gold">
                               <div className="panel-label">◆ ENTER LAST WINNING DRAW</div>
                               <div className="draw-row">
                                   <input className="big-input" maxLength={3} placeholder="000" value={lastDraw}
                                       onChange={e => setLastDraw(e.target.value.replace(/\D/g, "").slice(0, 3))} />
                                   {keyDigits.length > 0 && (
                                       <div className="key-chips">
                                           <span style={{ fontSize: "0.58rem", color: "var(--dim)", letterSpacing: "2px", alignSelf: "center" }}>KEY DIGITS →</span>
                                           {keyDigits.map((d, i) => (
                                               <div key={d} className="key-chip-wrap">
                                                   <div className={`key-chip kc-${i}`}>{d}</div>
                                                   <div className="kc-label">KEY {i + 1}</div>
                                               </div>
                                           ))}
                                       </div>
                                   )}
                               </div>
                           </div>

                           <div className="panel cyan">
                               <div className="panel-label cyan">◆ SMART FILTERS</div>
                               <div className="filter-grid">
                                   {[
                                       { k: "noTriples", name: "NO TRIPLES", desc: "Remove 000, 111…999. Extremely rare hits.", impact: "Removes 3–10 numbers" },
                                       { k: "noNonKeyDoubles", name: "NO COLD DOUBLES", desc: "Block combos where a non-key digit repeats (e.g. key=1, block 033).", impact: "Removes ~50–100 numbers" },
                                       { k: "noAllOdd", name: "NO ALL-ODD", desc: "Remove all-odd digit combos (1,3,5,7,9 only).", impact: "Removes ~10–30 numbers" },
                                       { k: "noAllEven", name: "NO ALL-EVEN", desc: "Remove all-even digit combos (0,2,4,6,8 only).", impact: "Removes ~10–30 numbers" },
                                   ].map(f => (
                                       <div key={f.k} className={`fcard ${filters[f.k] ? "on" : ""}`} onClick={() => toggleFilter(f.k)}>
                                           <div className="fcard-top">
                                               <span className="fcard-name">{f.name}</span>
                                               <div className={`toggle ${filters[f.k] ? "on" : ""}`} />
                                           </div>
                                           <div className="fcard-desc">{f.desc}</div>
                                           <div className="fcard-impact">▾ {f.impact}</div>
                                       </div>
                                   ))}

                                   <div className={`fcard ${filters.sumRange ? "on" : ""}`} onClick={() => toggleFilter("sumRange")}>
                                       <div className="fcard-top">
                                           <span className="fcard-name">DIGIT SUM RANGE</span>
                                           <div className={`toggle ${filters.sumRange ? "on" : ""}`} />
                                       </div>
                                       <div className="fcard-desc">Keep numbers whose digit total falls between min and max.</div>
                                       {filters.sumRange && (
                                           <div className="sub-controls" onClick={e => e.stopPropagation()}>
                                               <span className="mini-label">MIN</span>
                                               <input className="mini-input" type="number" min={0} max={27} value={sumMin}
                                                   onChange={e => setSumMin(+e.target.value)} />
                                               <span className="mini-label">MAX</span>
                                               <input className="mini-input" type="number" min={0} max={27} value={sumMax}
                                                   onChange={e => setSumMax(+e.target.value)} />
                                           </div>
                                       )}
                                       <div className="fcard-impact">▾ Removes extreme-sum outliers</div>
                                   </div>

                                   <div className={`fcard ${filters.keyInPosition ? "on" : ""}`} onClick={() => toggleFilter("keyInPosition")}>
                                       <div className="fcard-top">
                                           <span className="fcard-name">KEY IN POSITION</span>
                                           <div className={`toggle ${filters.keyInPosition ? "on" : ""}`} />
                                       </div>
                                       <div className="fcard-desc">Lock a key digit into position L, M, or R only.</div>
                                       {filters.keyInPosition && (
                                           <div className="sub-controls" onClick={e => e.stopPropagation()}>
                                               {["L","M","R"].map((p, i) => (
                                                   <button key={i} className={`pos-btn ${filters.keyPosition === i ? "sel" : ""}`}
                                                       onClick={() => setFilters(f => ({...f, keyPosition: i}))}>{p}</button>
                                               ))}
                                           </div>
                                       )}
                                       <div className="fcard-impact">▾ Removes ~66% of plays per position</div>
                                   </div>
                               </div>
                           </div>

                           {keyDigits.length > 0 && (
                               <>
                                   <div className="stats-row">
                                       <div className="scard g">
                                           <div className={`snum ${filteredStraight.length > 600 ? "" : ""}`} style={{ color: filteredStraight.length > 600 ? "var(--red)" : "var(--gold)" }}>
                                               {filteredStraight.length}
                                           </div>
                                           <div className="slabel">Straight Plays</div>
                                           <div className="stag" style={{ color: filteredStraight.length > 600 ? "var(--red)" : "var(--green)" }}>
                                               {filteredStraight.length > 600 ? `▲ ${filteredStraight.length - 600} OVER TARGET` : "✓ WITHIN 600"}
                                           </div>
                                       </div>
                                       <div className="scard c">
                                           <div className="snum">{filteredBox.length}</div>
                                           <div className="slabel">Box Plays</div>
                                           <div className="stag" style={{ color: "var(--dim)" }}>UNIQUE COMBOS</div>
                                       </div>
                                       <div className="scard gr">
                                           <div className="snum">{reduction}%</div>
                                           <div className="slabel">Reduction</div>
                                           <div className="stag" style={{ color: "var(--dim)" }}>FROM 1,000 POOL</div>
                                       </div>
                                       <div className="scard p">
                                           <div className="snum">{keyDigits.length}</div>
                                           <div className="slabel">Key Digits</div>
                                           <div className="stag" style={{ color: "var(--dim)" }}>{keyDigits.join(" · ")}</div>
                                       </div>
                                   </div>

                                   <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "14px" }}>
                                       {[
                                           { label: "STRAIGHT PLAYS", nums: filteredStraight.map(fmt3), color: "var(--gold)", border: "rgba(245,200,66,0.25)" },
                                           { label: "BOX PLAYS", nums: filteredBox, color: "var(--cyan)", border: "rgba(0,212,255,0.25)" },
                                       ].map(col => (
                                           <div key={col.label} style={{ background: "var(--panel)", border: "1px solid var(--border)", borderRadius: "12px", overflow: "hidden" }}>
                                               <div style={{ padding: "12px 16px", borderBottom: "1px solid var(--border)", display: "flex", justifyContent: "space-between" }}>
                                                   <span style={{ fontFamily: "Bebas Neue", fontSize: "1rem", letterSpacing: "3px", color: col.color }}>{col.label}</span>
                                                   <span style={{ fontSize: "0.65rem", padding: "2px 10px", borderRadius: "10px", background: `${col.color}15`, color: col.color }}>{col.nums.length}</span>
                                               </div>
                                               <div style={{ padding: "12px", maxHeight: "280px", overflowY: "auto", display: "flex", flexWrap: "wrap", gap: "4px" }}>
                                                   {col.nums.map(n => (
                                                       <span key={n} style={{ fontSize: "0.7rem", padding: "3px 7px", borderRadius: "4px",
                                                           border: `1px solid ${col.border}`, color: col.color, background: `${col.color}08` }}>{n}</span>
                                                   ))}
                                               </div>
                                           </div>
                                       ))}
                                   </div>
                               </>
                           )}
                           {keyDigits.length === 0 && (
                               <div className="no-data">◆ ENTER YOUR LAST WINNING DRAW ABOVE TO BEGIN ANALYSIS ◆</div>
                           )}
                       </>
                   )}

                   {/* ===== TAB 2: BET TIERS ===== */}
                   {activeTab === "tiers" && (
                       <>
                           <div className="panel orange">
                               <div className="panel-label orange">◆ YOUR PLAY BUDGET</div>
                               <div className="budget-input-row">
                                   <span className="budget-label">$</span>
                                   <input className="budget-input" type="number" min={1} max={9999} value={budget}
                                       onChange={e => setBudget(Math.max(1, +e.target.value))} />
                                   <span className="budget-label">TOTAL BUDGET</span>
                               </div>
                           </div>

                           <div className="tier-grid">
                               {TIERS.map(tier => {
                                   const maxPlays = Math.floor(budget / tier.price);
                                   const costIfMax = maxPlays * tier.price;
                                   const coverPct = filteredStraight.length > 0 ? Math.min(100, Math.round(maxPlays / filteredStraight.length * 100)) : 0;
                                   const profit = tier.win - costIfMax;
                                   return (
                                       <div key={tier.id} className={`tier-card ${tier.id}`}>
                                           <div className="tier-header">
                                               <div className="tier-price-row">
                                                   <div>
                                                       <div className="tier-price">{fmtMoney(tier.price)}</div>
                                                       <div className="tier-label">PER NUMBER</div>
                                                   </div>
                                                   <div className="tier-win-badge">
                                                       <div className="tier-win-label">WIN IF HIT</div>
                                                       <div className="tier-win-amount">{fmtMoney(tier.win)}</div>
                                                   </div>
                                               </div>
                                           </div>
                                           <div className="tier-body">
                                               <div className="tier-stat-row">
                                                   <span className="tier-stat-key">MAX PLAYS (budget)</span>
                                                   <span className="tier-stat-val" style={{ color: tier.color }}>{maxPlays.toLocaleString()}</span>
                                               </div>
                                               <div className="tier-stat-row">
                                                   <span className="tier-stat-key">COST AT MAX</span>
                                                   <span className="tier-stat-val">{fmtMoney(costIfMax)}</span>
                                               </div>
                                               <div className="tier-stat-row">
                                                   <span className="tier-stat-key">POOL COVERAGE</span>
                                                   <span className="tier-stat-val">{coverPct}% of {filteredStraight.length || "—"} plays</span>
                                               </div>
                                               <div className="tier-stat-row">
                                                   <span className="tier-stat-key">NET PROFIT IF HIT</span>
                                                   <span className={`tier-profit ${profit >= 0 ? "profit-pos" : "profit-neg"}`}>
                                                       {profit >= 0 ? "+" : ""}{fmtMoney(profit)}
                                                   </span>
                                               </div>
                                               <div className="tier-stat-row">
                                                   <span className="tier-stat-key">PRIZE / COST RATIO</span>
                                                   <span className="tier-stat-val">{costIfMax > 0 ? (tier.win / costIfMax).toFixed(1) : "—"}:1</span>
                                               </div>

                                               <div className="progress-bar-wrap">
                                                   <div className="progress-bar-label">
                                                       <span>POOL COVERAGE</span>
                                                       <span>{coverPct}%</span>
                                                   </div>
                                                   <div className="progress-bar-track">
                                                       <div className="progress-bar-fill" style={{ width: `${coverPct}%` }} />
                                                   </div>
                                               </div>

                                               {filteredStraight.length > 0 && (
                                                   <button
                                                       onClick={() => { selectByBudget(tier.id); setActiveTab("builder"); }}
                                                       style={{
                                                           marginTop: "14px", width: "100%", padding: "10px",
                                                           background: `${tier.color}18`, border: `1px solid ${tier.color}`,
                                                           color: tier.color, borderRadius: "7px", fontFamily: "Share Tech Mono",
                                                           fontSize: "0.65rem", letterSpacing: "2px", cursor: "pointer", transition: "all 0.2s"
                                                       }}
                                                   >
                                                       AUTO-SELECT {Math.min(maxPlays, filteredStraight.length)} PLAYS AT {fmtMoney(tier.price)} →
                                                   </button>
                                               )}
                                           </div>
                                       </div>
                                   );
                               })}
                           </div>

                           {/* Comparison table */}
                           {filteredStraight.length > 0 && (
                               <div className="panel green" style={{ marginTop: 16 }}>
                                   <div className="panel-label green">◆ TIER COMPARISON — FULL POOL COST</div>
                                   <div style={{ overflowX: "auto" }}>
                                       <table style={{ width: "100%", borderCollapse: "collapse", fontSize: "0.72rem" }}>
                                           <thead>
                                               <tr>
                                                   {["TIER", "COST / NUM", "WIN", "PLAYS TO COVER POOL", "TOTAL COST", "NET PROFIT"].map(h => (
                                                       <th key={h} style={{ padding: "10px 12px", textAlign: "left", color: "var(--dim)", borderBottom: "1px solid var(--border)", letterSpacing: "2px", fontSize: "0.58rem" }}>{h}</th>
                                                   ))}
                                               </tr>
                                           </thead>
                                           <tbody>
                                               {TIERS.map((tier, i) => {
                                                   const total = filteredStraight.length * tier.price;
                                                   const net = tier.win - total;
                                                   return (
                                                       <tr key={tier.id} style={{ borderBottom: "1px solid var(--border)" }}>
                                                           <td style={{ padding: "10px 12px", color: tier.color, fontFamily: "Bebas Neue", fontSize: "1rem", letterSpacing: "2px" }}>{tier.label}</td>
                                                           <td style={{ padding: "10px 12px", color: "var(--text)" }}>{fmtMoney(tier.price)}</td>
                                                           <td style={{ padding: "10px 12px", color: tier.color }}>{fmtMoney(tier.win)}</td>
                                                           <td style={{ padding: "10px 12px", color: "var(--text)" }}>{filteredStraight.length}</td>
                                                           <td style={{ padding: "10px 12px", color: "var(--text)" }}>{fmtMoney(total)}</td>
                                                           <td style={{ padding: "10px 12px" }}>
                                                               <span style={{ color: net >= 0 ? "var(--green)" : "var(--red)", fontFamily: "Bebas Neue", fontSize: "1rem" }}>
                                                                   {net >= 0 ? "+" : ""}{fmtMoney(net)}
                                                               </span>
                                                           </td>
                                                       </tr>
                                                   );
                                               })}
                                           </tbody>
                                       </table>
                                   </div>
                               </div>
                           )}
                       </>
                   )}

                   {/* ===== TAB 3: TICKET BUILDER ===== */}
                   {activeTab === "builder" && (
                       <>
                           {filteredStraight.length === 0 ? (
                               <div className="no-data">◆ ENTER A DRAW NUMBER ON THE ANALYZE TAB FIRST ◆</div>
                           ) : (
                               <>
                                   <div className="panel purple">
                                       <div className="panel-label purple">◆ BUILD YOUR TICKET — TAP TO ASSIGN TIER</div>
                                       <div className="play-controls">
                                           <div className="tier-select-row" style={{ flex: 1 }}>
                                               {TIERS.map(t => (
                                                   <button key={t.id} className={`tier-sel-btn ${t.id} ${activeTier === t.id ? "sel" : ""}`}
                                                       onClick={() => setActiveTier(t.id)}>
                                                       {fmtMoney(t.price)}/NUM<br /><span style={{ fontSize: "0.55rem" }}>WIN {fmtMoney(t.win)}</span>
                                                   </button>
                                               ))}
                                           </div>
                                           <button className="select-btn" onClick={clearAll}>CLEAR ALL</button>
                                           <button className={`select-btn active`}
                                               onClick={() => {
                                                   const next = {};
                                                   filteredStraight.forEach(n => { next[fmt3(n)] = activeTier; });
                                                   setSelectedNums(next);
                                               }}>SELECT ALL</button>
                                       </div>

                                       <div style={{ fontSize: "0.6rem", color: "var(--dim)", marginBottom: "10px", letterSpacing: "2px" }}>
                                           ACTIVE TIER: <span style={{ color: TIERS.find(t => t.id === activeTier)?.color }}>
                                               {fmtMoney(TIERS.find(t => t.id === activeTier)?.price || 0)} → WIN {fmtMoney(TIERS.find(t => t.id === activeTier)?.win || 0)}
                                           </span> · CLICK NUMBERS TO ASSIGN
                                       </div>

                                       <div className="num-grid-wrap">
                                           <div className="num-grid">
                                               {filteredStraight.map(n => {
                                                   const key = fmt3(n);
                                                   const tier = getSelTier(n);
                                                   return (
                                                       <span key={n} className={`npill ${tier ? `sel-${tier}` : "default"}`}
                                                           onClick={() => toggleNum(n)}>{key}</span>
                                                   );
                                               })}
                                           </div>
                                       </div>
                                   </div>

                                   {/* Live ticket summary */}
                                   <div className="stats-row">
                                       {TIERS.map(t => (
                                           <div key={t.id} className="scard" style={{ borderBottom: `2px solid ${t.color}` }}>
                                               <div className="snum" style={{ color: t.color }}>{selCounts[t.id]}</div>
                                               <div className="slabel">{fmtMoney(t.price)} PLAYS</div>
                                               <div className="stag" style={{ color: t.color }}>{fmtMoney(selCounts[t.id] * t.price)}</div>
                                           </div>
                                       ))}
                                       <div className="scard g">
                                           <div className="snum">{fmtMoney(totalCost)}</div>
                                           <div className="slabel">TOTAL COST</div>
                                       </div>
                                       <div className="scard gr">
                                           <div className="snum" style={{ color: netProfit >= 0 ? "var(--green)" : "var(--red)" }}>
                                               {netProfit > 0 ? "+" : ""}{fmtMoney(netProfit)}
                                           </div>
                                           <div className="slabel">MAX NET PROFIT</div>
                                           <div className="stag" style={{ color: "var(--dim)" }}>IF ONE HIT</div>
                                       </div>
                                   </div>

                                   {/* Ticket card */}
                                   {Object.keys(selectedNums).length > 0 && (
                                       <div className="ticket">
                                           <div className="ticket-header">
                                               <div>
                                                   <div className="ticket-title">PLAY TICKET</div>
                                                   <div className="ticket-date">DRAW: {lastDraw} · KEYS: {keyDigits.join("-")}</div>
                                               </div>
                                               <button className="copy-ticket-btn" onClick={() => {
                                                   const lines = TIERS.map(t => {
                                                       const nums = Object.entries(selectedNums).filter(([,v]) => v === t.id).map(([k]) => k);
                                                       if (!nums.length) return null;
                                                       return `${fmtMoney(t.price)}/ea · WIN ${fmtMoney(t.win)}\n${nums.join(" ")}`;
                                                   }).filter(Boolean);
                                                   navigator.clipboard.writeText(`PICK 3 TICKET\nLast Draw: ${lastDraw} · Keys: ${keyDigits.join(",")}\n\n${lines.join("\n\n")}\n\nTOTAL COST: ${fmtMoney(totalCost)} | MAX WIN: ${fmtMoney(bestWin)} | NET: +${fmtMoney(netProfit)}`).catch(() => {});
                                                   alert("Ticket copied to clipboard!");
                                               }}>COPY TICKET</button>
                                           </div>

                                           <div className="ticket-tiers">
                                               {TIERS.map(t => {
                                                   const nums = Object.entries(selectedNums).filter(([,v]) => v === t.id).map(([k]) => k);
                                                   if (!nums.length) return null;
                                                   return (
                                                       <div key={t.id} className={`ticket-tier ${t.id}`}>
                                                           <div className="ticket-tier-head">
                                                               <span className={`tt-price ${t.id}`}>{fmtMoney(t.price)}/NUM · WIN {fmtMoney(t.win)}</span>
                                                               <span style={{ color: "var(--dim)", fontSize: "0.6rem" }}>{nums.length} plays · {fmtMoney(nums.length * t.price)}</span>
                                                           </div>
                                                           <div className="tt-nums">
                                                               {nums.map(n => <span key={n} className={`tt-num ${t.id}`}>{n}</span>)}
                                                           </div>
                                                       </div>
                                                   );
                                               })}
                                           </div>

                                           <div className="ticket-footer">
                                               <div className="tf-item">
                                                   <div className="tf-val" style={{ color: "var(--text)" }}>{fmtMoney(totalCost)}</div>
                                                   <div className="tf-label">TOTAL COST</div>
                                               </div>
                                               <div className="tf-item">
                                                   <div className="tf-val" style={{ color: "var(--gold)" }}>{fmtMoney(bestWin)}</div>
                                                   <div className="tf-label">MAX WIN</div>
                                               </div>
                                               <div className="tf-item">
                                                   <div className="tf-val" style={{ color: "var(--green)" }}>+{fmtMoney(netProfit)}</div>
                                                   <div className="tf-label">NET PROFIT</div>
                                               </div>
                                               <div className="tf-item">
                                                   <div className="tf-val" style={{ color: "var(--purple)" }}>{Object.keys(selectedNums).length}</div>
                                                   <div className="tf-label">TOTAL PLAYS</div>
                                               </div>
                                           </div>
                                       </div>
                                   )}
                               </>
                           )}
                       </>
                   )}
               </div>
           );
       }

       ReactDOM.createRoot(document.getElementById('root')).render(<Pick3FullStrategy />);
   </script>
</body>
</html>
